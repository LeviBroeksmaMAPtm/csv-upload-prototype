<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <meta name="description" content="Tailwind CSS - MAPtm template">
  <meta name="author" content="by MAPtm">

  <title>Tailwind CSS - MAPtm template</title>

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/site.webmanifest">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="/icons/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="/icons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <!-- Configuration -->
  <script defer src="../../config.min.js" inline></script>

  <!-- Tailwind CSS -->
  <link rel="stylesheet" href="../../assets/tailwind.min.css" inline>

  <!-- AWS Cognito -->
  <script defer src="../../assets/aws-sdk-2.610.0.min.js"></script>
  <script defer src="../../assets/amazon-cognito-identity.min.js"></script>
  <script defer src="../../assets/maptm_cognito.js"></script>

  <!-- Alpine.js -->
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.7.0/dist/alpine.min.js" defer></script>

  <!-- Diff.js -->
  <script defer src="../../assets/diff.js"></script>

  <!-- Helper functions -->
  <script defer src="../../assets/helper_functions.js"></script>

  <!-- Main -->
  <link rel="stylesheet" href="../../main.min.css" inline>
  <script defer src="../../main.min.js" inline></script>

  <!-- Other JavaScript dependencies -->
  <script src="https://www.unpkg.com/papaparse@5.3.1/papaparse.min.js" defer></script>

</head>

<body data-app="home" class="w-full min-h-screen flex flex-col bg-gray-200">
  <header class="py-8 h-24 bg-gray-400">
    <div class="w-full text-center mb-64">
      <a href="/" class=" bg-red-600 py-2 px-4 text-white">Plain JavaScript</a>
    </div>
  </header>

  <main class="h-full py-24 px-12">
    <div x-data="csvParser()">
      <div class="flex justify-center w-full gap-4 ">
        <!-- UPLOAD FORM -->
        <div class="bg-gray-50 box-content p-8 rounded-lg">
          <h2 class="text-2xl mb-8 font-bold">Upload jouw CSV</h2>

          <form @submit.prevent="submit" id="myForm" class="flex flex-col h-24 justify-between">
            <input type="file" id="csvFile" accept=".csv" />
            <input id="btn-upload" type="submit" value="Upload je CSV"
              class=" items-center px-4 py-2 text-center text-sm leading-5 font-medium rounded-md text-white bg-teal-600 hover:bg-teal-500 focus:outline-none focus:shadow-outline-green focus:border-teal-700 active:bg-teal-700 transition duration-150 ease-in-out" />
          </form>

        </div>

        <div class="relative h-full bg-gray-50 rounded-b-lg overflow-hidden">
          <div class="bg-gray-600 rounded-t-lg px-8 py-6 text-white">
            <h2 class="text-lg font-medium leading-6 text-gray-100 sm:truncate">Preview</h2>
            <p class="mt-1 text-sm leading-5 text-gray-300">Hieronder zie je een preview van de ge-uploade CSV. Dubbele regels zijn gefilterd en verwijdert zodat enkel unieke regels worden toegevoegd wanneer je de CSV opslaat.</p>
          </div>
          <table class="min-w-full divide-y divide-gray-200 rounded-b-lg">
            <thead>
              <tr class="border-b border-white">
                <th
                  class="p-4 bg-gray-50 text-left text-xs leading-4 text-gray-500 uppercase tracking-wider sm:px-6 lg:px-8 font-bold">
                  Longitude
                </th>
                <th
                  class="p-4 bg-gray-50 text-left text-xs leading-4 text-gray-500 uppercase tracking-wider sm:px-6 lg:px-8 font-bold">
                  Latitude
                </th>
                <th
                  class="p-4 bg-gray-50 text-left text-xs leading-4 text-gray-500 uppercase tracking-wider sm:px-6 lg:px-8 font-bold">
                  Modaliteit
                </th>
                <th
                  class="p-4 bg-gray-50 text-left text-xs leading-4 text-gray-500 uppercase tracking-wider sm:px-6 lg:px-8 font-bold">
                  ID
                </th>
                <th
                  class="p-4 bg-gray-50 text-left text-xs leading-4 text-gray-500 uppercase tracking-wider sm:px-6 lg:px-8 font-bold">
                  Naam
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="(row, index) in tempArr" :key="index">
                <tr class="border-b border-white">
                  <td x-text="row.longitude" class="p-4 whitespace-no-wrap text-sm leading-5 text-gray-500 font-bold text-left sm:px-6 lg:px-8"></td>
                  <td x-text="row.latitude" class="p-4 whitespace-no-wrap text-sm leading-5 text-gray-500 font-bold text-left sm:px-6 lg:px-8"></td>
                  <td x-text="row.modaliteit" class="p-4 whitespace-no-wrap text-sm leading-5 text-gray-500 font-bold text-left sm:px-6 lg:px-8"></td>
                  <td x-text="row.id != '' ? row.id : 'n.v.t.' "
                    class="p-4 whitespace-no-wrap text-sm leading-5 text-gray-500 text-left sm:px-6 lg:px-8"></td>
                  <td x-text="row.naam != '' ? row.naam : 'n.v.t.' "
                    class="p-4 whitespace-no-wrap text-sm leading-5 text-gray-500 text-left sm:px-6 lg:px-8"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <script type='text/javascript'>
    window.csvParser = () => {
      return {
        tempArr: [],
        submit() {
          Papa.parse(document.getElementById('csvFile').files[0], {
            header: true,
            delimeter: ",",
            newline: "\n",
            skipEmptyLines: true,
            complete: results => {
              const arrToBeFiltered = results.data,
                filtered = arrToBeFiltered.filter((a) => {
                  const key = a.longitude + '|' + a.latitude + '|' + a.modaliteit;
                  if (!this[key]) {
                    this[key] = true;
                    return true;
                  }
                }, Object.create(null))
              this.tempArr = filtered;
            }
          });
        }
      }
    };
  </script>

  <!-- Alpine.js dependencies -->
  <script src="../../_imports/alpine_func_footer.min.js"></script>

  <!-- <script src="./alpine_func_users.min.js"></script> -->
  <!-- <script src="./alpine_func_projects.min.js"></script> -->
</body>

</html>